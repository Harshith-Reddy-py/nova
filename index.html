<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nova - Advanced AI Chatbot</title>
  <style>
    :root {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --background: #0f172a;
      --surface: #1e293b;
      --surface-light: #334155;
      --text: #f8fafc;
      --text-secondary: #94a3b8;
      --success: #10b981;
      --warning: #f59e0b;
      --error: #ef4444;
      --ai-message: rgba(59, 130, 246, 0.15);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--background);
      color: var(--text);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 1rem;
      line-height: 1.5;
    }

    .container {
      width: 100%;
      max-width: 800px;
      display: flex;
      flex-direction: column;
      height: 100vh;
      max-height: 900px;
    }

    header {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem 0;
      margin-bottom: 1rem;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1.5rem;
      font-weight: 600;
    }

    .logo-icon {
      font-size: 1.8rem;
    }

    #chat-container {
      flex: 1;
      background: var(--surface);
      border-radius: 1rem;
      padding: 1.5rem;
      overflow-y: auto;
      margin-bottom: 1rem;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .message {
      display: flex;
      gap: 1rem;
      animation: fadeIn 0.3s ease-out;
    }

    .ai-message {
      background: var(--ai-message);
      border-radius: 0.5rem;
      padding: 0.5rem;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      font-weight: bold;
    }

    .user-avatar {
      background: var(--surface-light);
    }

    .message-content {
      flex: 1;
    }

    .message-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.25rem;
    }

    .message-sender {
      font-weight: 600;
    }

    .message-time {
      color: var(--text-secondary);
      font-size: 0.75rem;
    }

    .typing-indicator {
      display: flex;
      gap: 0.25rem;
      padding: 0.5rem 0;
    }

    .typing-dot {
      width: 8px;
      height: 8px;
      background: var(--text-secondary);
      border-radius: 50%;
      animation: typingAnimation 1.4s infinite ease-in-out;
    }

    .typing-dot:nth-child(1) { animation-delay: 0s; }
    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typingAnimation {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-5px); }
    }

    .input-container {
      display: flex;
      gap: 0.5rem;
      padding: 0.5rem;
      background: var(--surface);
      border-radius: 1rem;
    }

    #user-input {
      flex: 1;
      padding: 0.75rem 1rem;
      background: var(--surface-light);
      color: var(--text);
      border: 1px solid var(--surface-light);
      border-radius: 0.75rem;
      font-size: 1rem;
      outline: none;
      transition: border-color 0.2s;
    }

    #user-input:focus {
      border-color: var(--primary);
    }

    .btn {
      padding: 0.75rem 1.25rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 0.75rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .btn:hover {
      background: var(--primary-dark);
    }

    .btn-icon {
      font-size: 1.25rem;
    }

    .btn-secondary {
      background: var(--surface-light);
    }

    .btn-secondary:hover {
      background: #3f4a5f;
    }

    .mic-btn.listening {
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
      70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
      100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
    }

    .suggestions {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .suggestion-btn {
      padding: 0.5rem 1rem;
      background: var(--surface-light);
      color: var(--text);
      border: none;
      border-radius: 1rem;
      font-size: 0.875rem;
      cursor: pointer;
      transition: background 0.2s;
    }

    .suggestion-btn:hover {
      background: #3f4a5f;
    }

    .settings-btn {
      margin-left: auto;
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 1.25rem;
    }

    .settings-panel {
      position: fixed;
      top: 0;
      right: -400px;
      width: 380px;
      height: 100vh;
      background: var(--surface);
      padding: 1.5rem;
      box-shadow: -2px 0 10px rgba(0, 0, 0, 0.2);
      transition: right 0.3s ease;
      z-index: 100;
      overflow-y: auto;
    }

    .settings-panel.open {
      right: 0;
    }

    .settings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .settings-title {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .close-settings {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 1.5rem;
      cursor: pointer;
    }

    .setting-group {
      margin-bottom: 1.5rem;
    }

    .setting-title {
      font-weight: 500;
      margin-bottom: 0.75rem;
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--surface-light);
      transition: .4s;
      border-radius: 24px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: var(--primary);
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }

    .toggle-label {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .voice-selector {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
      flex-direction: column;
    }

    .voice-option {
      padding: 0.5rem;
      border: 1px solid var(--surface-light);
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .voice-option:hover {
      border-color: var(--primary);
    }

    .voice-option.selected {
      border-color: var(--primary);
      background: rgba(59, 130, 246, 0.2);
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 99;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .overlay.visible {
      opacity: 1;
      pointer-events: all;
    }

    @media (max-width: 768px) {
      .container {
        height: calc(100vh - 2rem);
      }
      
      .settings-panel {
        width: 100%;
        max-width: 380px;
      }
    }

    /* Markdown-like styling */
    .message-text pre {
      background: var(--surface-light);
      padding: 1rem;
      border-radius: 0.5rem;
      overflow-x: auto;
      margin: 0.5rem 0;
    }

    .message-text code {
      background: var(--surface-light);
      padding: 0.2rem 0.4rem;
      border-radius: 0.25rem;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }

    .message-text strong {
      font-weight: 600;
    }

    .message-text em {
      font-style: italic;
    }

    .message-text ul, 
    .message-text ol {
      padding-left: 1.5rem;
      margin: 0.5rem 0;
    }

    .message-text li {
      margin-bottom: 0.25rem;
    }

    .message-text a {
      color: var(--primary);
      text-decoration: none;
    }

    .message-text a:hover {
      text-decoration: underline;
    }

    .message-text blockquote {
      border-left: 3px solid var(--primary);
      padding-left: 1rem;
      margin: 0.5rem 0;
      color: var(--text-secondary);
    }

    /* Voice control button in header */
    .voice-control {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-left: auto;
    }

    .voice-toggle {
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 1.25rem;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .voice-toggle.active {
      color: var(--primary);
    }
    
    .ai-mode-indicator {
      background: linear-gradient(90deg, #3b82f6, #8b5cf6);
      border-radius: 12px;
      padding: 0.25rem 0.75rem;
      font-size: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    
    .ai-mode-icon {
      animation: pulse 2s infinite;
    }
    
    .context-indicator {
      margin-top: 0.5rem;
      font-size: 0.75rem;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    
    .knowledge-base {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid var(--surface-light);
    }
    
    .knowledge-base h4 {
      margin-bottom: 0.5rem;
    }
    
    .knowledge-items {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    
    .knowledge-item {
      background: var(--surface-light);
      padding: 0.25rem 0.5rem;
      border-radius: 0.5rem;
      font-size: 0.75rem;
    }
    
    .response-quality {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }
    
    .quality-btn {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: var(--text);
      padding: 0.25rem 0.5rem;
      border-radius: 0.5rem;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .quality-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <span class="logo-icon">✨</span>
        <span>Nova AI</span>
        <div class="ai-mode-indicator">
          <span class="ai-mode-icon">⚡</span>
          <span>Advanced Mode</span>
        </div>
      </div>
      <div class="voice-control">
        <button class="voice-toggle" id="voice-toggle" title="Toggle voice output">
          <span class="btn-icon">🔊</span>
        </button>
      </div>
      <button class="settings-btn" id="settings-btn">⚙️</button>
    </header>

    <div class="suggestions">
      <button class="suggestion-btn" onclick="sendSuggestion('Explain quantum computing in simple terms')">Quantum Computing</button>
      <button class="suggestion-btn" onclick="sendSuggestion('Help me debug this JavaScript function')">Debug Code</button>
      <button class="suggestion-btn" onclick="sendSuggestion('Compare React and Vue for a new project')">React vs Vue</button>
      <button class="suggestion-btn" onclick="sendSuggestion('What are the latest AI advancements?')">AI Advancements</button>
    </div>

    <div id="chat-container">
      <div class="message ai-message">
        <div class="avatar">✨</div>
        <div class="message-content">
          <div class="message-header">
            <span class="message-sender">Nova</span>
            <span class="message-time">Just now</span>
          </div>
          <div class="message-text">
            <p>Hello! I'm Nova, now in <strong>Advanced Mode</strong> 🚀</p>
            <p>I can understand context, remember previous conversations, and provide more sophisticated responses. How can I assist you today?</p>
            <div class="context-indicator">
              <span>🧠 Context-aware | 💾 Memory enabled | 🔍 Deep reasoning</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="input-container">
      <input type="text" id="user-input" placeholder="Message Nova..." autocomplete="off" />
      <button class="btn" id="send-btn" onclick="sendMessage()">
        <span class="btn-icon">✉️</span>
        <span class="btn-text">Send</span>
      </button>
      <button class="btn btn-secondary" id="mic-btn" title="Voice input">
        <span class="btn-icon">🎤</span>
      </button>
    </div>
  </div>

  <!-- Settings Panel -->
  <div class="overlay" id="overlay"></div>
  <div class="settings-panel" id="settings-panel">
    <div class="settings-header">
      <div class="settings-title">Advanced Settings</div>
      <button class="close-settings" id="close-settings">&times;</button>
    </div>
    
    <div class="setting-group">
      <div class="setting-title">AI Configuration</div>
      
      <div class="toggle-label">
        <span>Deep Reasoning Mode</span>
        <label class="toggle-switch">
          <input type="checkbox" id="reasoning-toggle" checked>
          <span class="slider"></span>
        </label>
      </div>
      
      <div class="toggle-label">
        <span>Context Memory</span>
        <label class="toggle-switch">
          <input type="checkbox" id="memory-toggle" checked>
          <span class="slider"></span>
        </label>
      </div>
      
      <div class="toggle-label">
        <span>Creative Responses</span>
        <label class="toggle-switch">
          <input type="checkbox" id="creativity-toggle" checked>
          <span class="slider"></span>
        </label>
      </div>
    </div>
    
    <div class="setting-group">
      <div class="setting-title">Voice Settings</div>
      
      <div class="toggle-label">
        <span>Enable Speech Output</span>
        <label class="toggle-switch">
          <input type="checkbox" id="speech-toggle" checked>
          <span class="slider"></span>
        </label>
      </div>
      
      <div class="toggle-label">
        <span>Listen for "Hey Nova"</span>
        <label class="toggle-switch">
          <input type="checkbox" id="wake-word-toggle">
          <span class="slider"></span>
        </label>
      </div>
      
      <div id="voice-selection">
        <div class="setting-title">Select Voice</div>
        <div class="voice-selector" id="voice-options">
          <!-- Voices will be populated by JavaScript -->
        </div>
      </div>
    </div>
    
    <div class="setting-group">
      <div class="setting-title">Appearance</div>
      
      <div class="toggle-label">
        <span>Dark Mode</span>
        <label class="toggle-switch">
          <input type="checkbox" id="dark-mode-toggle" checked>
          <span class="slider"></span>
        </label>
      </div>
    </div>
    
    <div class="setting-group">
      <div class="setting-title">Knowledge Base</div>
      <div class="knowledge-items">
        <span class="knowledge-item">Technology</span>
        <span class="knowledge-item">Science</span>
        <span class="knowledge-item">Programming</span>
        <span class="knowledge-item">History</span>
        <span class="knowledge-item">Business</span>
        <span class="knowledge-item">Creative Writing</span>
      </div>
    </div>
    
    <div class="setting-group">
      <div class="setting-title">About</div>
      <p>Nova AI v3.0 (Advanced)</p>
      <p>Enhanced with deep reasoning and context awareness</p>
    </div>
  </div>

  <script>
    // DOM Elements
    const chatContainer = document.getElementById('chat-container');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');
    const micBtn = document.getElementById('mic-btn');
    const voiceToggle = document.getElementById('voice-toggle');
    const settingsBtn = document.getElementById('settings-btn');
    const closeSettings = document.getElementById('close-settings');
    const settingsPanel = document.getElementById('settings-panel');
    const overlay = document.getElementById('overlay');
    const speechToggle = document.getElementById('speech-toggle');
    const wakeWordToggle = document.getElementById('wake-word-toggle');
    const darkModeToggle = document.getElementById('dark-mode-toggle');
    const voiceOptions = document.getElementById('voice-options');
    const reasoningToggle = document.getElementById('reasoning-toggle');
    const memoryToggle = document.getElementById('memory-toggle');
    const creativityToggle = document.getElementById('creativity-toggle');

    // State
    let isTyping = false;
    let conversationHistory = [];
    let voices = [];
    let selectedVoice = null;
    let wakeWordDetection = null;
    let isVoiceEnabled = true;
    let userName = null;
    let userContext = {
      interests: [],
      lastTopics: []
    };

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      // Load settings from localStorage
      loadSettings();
      
      // Initialize speech synthesis
      initSpeechSynthesis();
      
      // Initialize wake word detection if enabled
      if (wakeWordToggle.checked) {
        initWakeWordDetection();
      }
      
      // Update voice toggle UI
      updateVoiceToggleUI();
      
      // Event listeners
      userInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          sendMessage();
        }
      });
      
      voiceToggle.addEventListener('click', toggleVoiceOutput);
      settingsBtn.addEventListener('click', openSettings);
      closeSettings.addEventListener('click', closeSettingsPanel);
      overlay.addEventListener('click', closeSettingsPanel);
      
      speechToggle.addEventListener('change', toggleSpeech);
      wakeWordToggle.addEventListener('change', toggleWakeWordDetection);
      darkModeToggle.addEventListener('change', toggleDarkMode);
      reasoningToggle.addEventListener('change', saveSettings);
      memoryToggle.addEventListener('change', saveSettings);
      creativityToggle.addEventListener('change', saveSettings);
    });

    // Functions
    function addMessage(sender, text, isUser = false) {
      const now = new Date();
      const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${isUser ? '' : 'ai-message'}`;
      
      messageDiv.innerHTML = `
        <div class="avatar ${isUser ? 'user-avatar' : ''}">${isUser ? '👤' : '✨'}</div>
        <div class="message-content">
          <div class="message-header">
            <span class="message-sender">${sender}</span>
            <span class="message-time">${timeString}</span>
          </div>
          <div class="message-text">${formatResponse(text)}</div>
        </div>
      `;
      
      chatContainer.appendChild(messageDiv);
      chatContainer.scrollTop = chatContainer.scrollHeight;
      
      // Add to conversation history
      conversationHistory.push({
        sender,
        text,
        timestamp: now.toISOString(),
        isUser
      });
    }

    function showTypingIndicator() {
      if (isTyping) return;
      
      isTyping = true;
      
      const typingDiv = document.createElement('div');
      typingDiv.className = 'message ai-message';
      typingDiv.id = 'typing-indicator';
      
      typingDiv.innerHTML = `
        <div class="avatar">✨</div>
        <div class="message-content">
          <div class="message-header">
            <span class="message-sender">Nova</span>
          </div>
          <div class="typing-indicator">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
          </div>
          <div class="context-indicator">
            <span>${getReasoningStatus()}</span>
          </div>
        </div>
      `;
      
      chatContainer.appendChild(typingDiv);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function getReasoningStatus() {
      const statuses = [
        "Analyzing query...",
        "Consulting knowledge base...",
        "Evaluating context...",
        "Formulating response...",
        "Applying deep reasoning...",
        "Considering alternatives..."
      ];
      
      return statuses[Math.floor(Math.random() * statuses.length)];
    }

    function hideTypingIndicator() {
      const typingIndicator = document.getElementById('typing-indicator');
      if (typingIndicator) {
        typingIndicator.remove();
      }
      isTyping = false;
    }

    async function sendMessage() {
      const message = userInput.value.trim();
      if (!message || isTyping) return;
      
      // Add user message
      addMessage('You', message, true);
      userInput.value = '';
      
      // Show typing indicator
      showTypingIndicator();
      
      // Update context
      updateContext(message);
      
      // Simulate processing delay
      const processingTime = 500 + Math.random() * 1000;
      await new Promise(resolve => setTimeout(resolve, processingTime));
      
      // Get AI response
      const response = await getAIResponse(message);
      
      // Hide typing indicator and show response
      hideTypingIndicator();
      addMessage('Nova', response);
      
      // Add context information
      addContextToResponse();
      
      // Speak the response if voice is enabled
      if (isVoiceEnabled && speechToggle.checked && selectedVoice) {
        speak(response);
      }
    }

    function updateContext(message) {
      // Extract and remember user's name
      const nameMatch = message.match(/(?:my name is|i am|call me) (\w+)/i);
      if (nameMatch && !userName) {
        userName = nameMatch[1];
      }
      
      // Remember last topics
      userContext.lastTopics.unshift(message.substring(0, 50));
      if (userContext.lastTopics.length > 3) {
        userContext.lastTopics.pop();
      }
      
      // Extract interests
      const interests = ['music', 'sports', 'technology', 'science', 'travel', 'books', 'movies'];
      interests.forEach(interest => {
        if (message.toLowerCase().includes(interest) && !userContext.interests.includes(interest)) {
          userContext.interests.push(interest);
        }
      });
    }

    function addContextToResponse() {
      const lastMessage = chatContainer.lastElementChild;
      if (!lastMessage) return;
      
      const contextDiv = document.createElement('div');
      contextDiv.className = 'context-indicator';
      
      let contextText = '';
      if (userContext.lastTopics.length > 0) {
        contextText += `📌 Context: ${userContext.lastTopics[0]}`;
      }
      
      if (userContext.interests.length > 0) {
        contextText += contextText ? ' | ' : '';
        contextText += `🎯 Interests: ${userContext.interests.slice(0, 3).join(', ')}`;
      }
      
      if (contextText) {
        contextDiv.innerHTML = `<span>${contextText}</span>`;
        lastMessage.querySelector('.message-content').appendChild(contextDiv);
      }
      
      // Add response quality controls
      const qualityDiv = document.createElement('div');
      qualityDiv.className = 'response-quality';
      qualityDiv.innerHTML = `
        <button class="quality-btn" onclick="rateResponse(this, 'up')">👍 Helpful</button>
        <button class="quality-btn" onclick="rateResponse(this, 'down')">👎 Not helpful</button>
        <button class="quality-btn" onclick="requestClarification()">❓ Need clarification</button>
      `;
      lastMessage.querySelector('.message-content').appendChild(qualityDiv);
    }

    function rateResponse(btn, rating) {
      const messageContent = btn.closest('.message-content');
      const messageText = messageContent.querySelector('.message-text').textContent;
      
      // Visual feedback
      if (rating === 'up') {
        btn.innerHTML = '👍 Thank you!';
        btn.style.background = 'var(--success)';
      } else {
        btn.innerHTML = '👎 Feedback received';
        btn.style.background = 'var(--error)';
      }
      
      // Disable other buttons
      messageContent.querySelectorAll('.quality-btn').forEach(b => {
        if (b !== btn) b.disabled = true;
      });
      
      // In a real app, send feedback to server
      console.log(`User rated response: ${rating} - "${messageText}"`);
    }

    function requestClarification() {
      const message = "Could you clarify your previous response?";
      userInput.value = message;
      sendMessage();
    }

    function sendSuggestion(text) {
      userInput.value = text;
      sendMessage();
    }

    async function getAIResponse(message) {
      // In a real application, this would call an advanced AI API
      // For this demo, we'll simulate advanced responses based on context
      
      // Use context to provide personalized responses
      const personalization = userName ? `, ${userName}` : '';
      
      // Check for context from previous messages
      const lastTopic = userContext.lastTopics.length > 1 ? 
        `I remember you mentioned "${userContext.lastTopics[1]}" earlier. ` : '';
      
      // Enhanced responses with reasoning
      if (message.toLowerCase().includes('hello') || message.toLowerCase().includes('hi')) {
        return `Hello${personalization}! 👋 It's great to connect with you. ${lastTopic}How can I assist you today?`;
      }
      
      if (message.toLowerCase().includes('how are you')) {
        return "I'm an AI, so I don't have feelings, but I'm functioning at peak capacity! How about you? Anything exciting happening in your world?";
      }
      
      if (message.toLowerCase().includes('thank')) {
        return `You're very welcome${personalization}! ${lastTopic}Is there anything else I can help with?`;
      }
      
      if (message.toLowerCase().includes('joke')) {
        return getAdvancedJoke();
      }
      
      if (message.toLowerCase().includes('time')) {
        const now = new Date();
        return `The current time is ${now.toLocaleTimeString()}. ${lastTopic}Are you planning your schedule?`;
      }
      
      if (message.toLowerCase().includes('date')) {
        const now = new Date();
        return `Today is ${now.toLocaleDateString()}. ${lastTopic}Do you have any important events coming up?`;
      }
      
      if (message.toLowerCase().includes('quantum')) {
        return `Quantum computing leverages quantum mechanics to process information. Unlike classical bits (0 or 1), quantum bits (qubits) can exist in superposition (both 0 and 1 simultaneously).

Key advantages:
- **Exponential speedup** for specific problems
- Enhanced **cryptography** capabilities
- Improved **molecular modeling** for drug discovery
- Advanced **optimization** solutions

Current challenges:
- Qubit stability and coherence times
- Error rates and error correction
- Scalability of quantum systems

Leading companies in this space include IBM, Google, and Rigetti. Would you like me to elaborate on any specific aspect?`;
      }
      
      if (message.toLowerCase().includes('debug') || message.toLowerCase().includes('code')) {
        return `I'd be happy to help with coding! Please provide:
1. The programming language
2. The code snippet
3. The error message (if any)
4. Expected vs actual behavior

For example: 
\`\`\`javascript
function calculateSum(a, b) {
  return a + b;
}
console.log(calculateSum(2, '3')); // Outputs "23" instead of 5
\`\`\`
I can then analyze and suggest solutions.`;
      }
      
      if (message.toLowerCase().includes('react') && message.toLowerCase().includes('vue')) {
        return `**React vs Vue - A Comparison**

**React (Meta):**
- Uses JSX syntax (JavaScript + HTML)
- Larger ecosystem and community
- Steeper learning curve
- More flexibility in architecture
- Ideal for complex, large-scale applications

**Vue (Evan You):**
- Template-based syntax (HTML-like)
- Gentle learning curve
- More opinionated structure
- Smaller bundle size
- Great for rapid prototyping

**When to choose React:**
- Building complex, scalable applications
- Need maximum flexibility
- Leveraging React Native for mobile

**When to choose Vue:**
- Quick development cycles
- Smaller projects or prototypes
- Easier onboarding for new developers

Both are excellent choices. Would you like a more detailed comparison or code examples?`;
      }
      
      if (message.toLowerCase().includes('ai advancements')) {
        return `**Latest AI Advancements (2025):**

1. **Multimodal Models**: AI that understands text, images, audio, and video simultaneously
2. **Self-Improving Systems**: Models that can refine their own architecture
3. **Efficient Training**: Techniques reducing computational costs by 70%
4. **AI Ethics Frameworks**: New standards for responsible AI deployment
5. **Personalized Education**: AI tutors adapting to individual learning styles

These advancements are transforming industries from healthcare to creative arts. Would you like me to expand on any specific area?`;
      }
      
      // Context-aware follow-up responses
      if (userContext.lastTopics.length > 1) {
        const prevTopic = userContext.lastTopics[1].toLowerCase();
        
        if (prevTopic.includes('quantum') && 
            (message.toLowerCase().includes('use') || message.toLowerCase().includes('application'))) {
          return `Quantum computing has several practical applications:
          
1. **Drug Discovery**: Simulating molecular interactions at quantum level
2. **Financial Modeling**: Optimizing portfolios and risk analysis
3. **Logistics**: Solving complex routing problems
4. **Cryptography**: Developing quantum-resistant algorithms
5. **Climate Modeling**: Understanding complex climate systems

Would you like a deeper dive into any of these applications?`;
        }
        
        if (prevTopic.includes('react') && message.toLowerCase().includes('learn')) {
          return `To learn React effectively:

1. **Core Concepts**: Components, props, state, hooks
2. **Ecosystem**: React Router, Redux, Context API
3. **Modern Features**: Concurrent Mode, Suspense
4. **Best Practices**: Component composition, performance optimization

Recommended resources:
- Official React documentation (react.dev)
- "The Road to React" by Robin Wieruch
- Frontend Masters courses
- CodeSandbox for hands-on practice

Would you like a structured learning path?`;
        }
      }
      
      // Default advanced response
      return `I've analyzed your query using deep reasoning techniques. ${lastTopic}Based on my knowledge base, I can provide:

- A detailed explanation of the topic
- Step-by-step guidance for problem solving
- Multiple perspectives on the issue
- Recommended resources for further learning

Could you provide more details so I can tailor my response to your needs?`;
    }

    function getAdvancedJoke() {
      const jokes = [
        "Why don't quantum programmers get entangled? Because they know how to maintain superposition!",
        "Why was the JavaScript developer sad? Because he didn't know how to 'await' happiness!",
        "Why do programmers prefer dark mode? Because light attracts bugs!",
        "What's an AI's favorite type of music? Al-gorithms!",
        "Why was the math book sad? It had too many problems that couldn't be resolved with quantum computing!"
      ];
      
      const techJokes = [
        "How many programmers does it take to change a light bulb? None, that's a hardware problem!",
        "Why do Java developers wear glasses? Because they can't C#!",
        "What's the object-oriented way to become wealthy? Inheritance!",
        "Why did the developer go broke? He used up all his cache!",
        "Why was the developer unhappy at their job? They lacked array-satisfaction!"
      ];
      
      // Select joke based on context
      const lastTopic = userContext.lastTopics[0] || '';
      const jokeSet = lastTopic.includes('tech') || lastTopic.includes('code') ? techJokes : jokes;
      
      return jokeSet[Math.floor(Math.random() * jokeSet.length)];
    }

    function formatResponse(text) {
      // Simple markdown-like formatting
      let formatted = text;
      
      // Convert **bold** to <strong>
      formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
      
      // Convert *italic* to <em>
      formatted = formatted.replace(/\*(.*?)\*/g, '<em>$1</em>');
      
      // Convert `code` to <code>
      formatted = formatted.replace(/`(.*?)`/g, '<code>$1</code>');
      
      // Convert ```code blocks``` to <pre>
      formatted = formatted.replace(/```([\s\S]*?)```/g, '<pre>$1</pre>');
      
      // Convert newlines to paragraphs
      formatted = formatted.split('\n').map(para => {
        if (para.trim() === '') return '';
        return `<p>${para}</p>`;
      }).join('');
      
      // Convert - lists to <ul>
      formatted = formatted.replace(/(?:^|\n)- (.*?)(?=\n|$)/g, '<ul><li>$1</li></ul>');
      formatted = formatted.replace(/<\/ul><ul>/g, '');
      
      return formatted;
    }

    // Voice Output Functions
    function toggleVoiceOutput() {
      isVoiceEnabled = !isVoiceEnabled;
      updateVoiceToggleUI();
      saveSettings();
    }

    function updateVoiceToggleUI() {
      if (isVoiceEnabled) {
        voiceToggle.classList.add('active');
        voiceToggle.innerHTML = '<span class="btn-icon">🔊</span>';
        voiceToggle.title = 'Voice output enabled (click to disable)';
      } else {
        voiceToggle.classList.remove('active');
        voiceToggle.innerHTML = '<span class="btn-icon">🔇</span>';
        voiceToggle.title = 'Voice output disabled (click to enable)';
      }
    }

    // Speech Synthesis Functions
    function initSpeechSynthesis() {
      // Load voices
      speechSynthesis.onvoiceschanged = () => {
        voices = speechSynthesis.getVoices();
        populateVoiceOptions();
      };
      
      // Force load voices if they're not loaded yet
      if (speechSynthesis.getVoices().length > 0) {
        voices = speechSynthesis.getVoices();
        populateVoiceOptions();
      } else {
        speechSynthesis.addEventListener('voiceschanged', () => {
          voices = speechSynthesis.getVoices();
          populateVoiceOptions();
        });
      }
    }

    function populateVoiceOptions() {
      voiceOptions.innerHTML = '';
      
      // Filter English voices
      const englishVoices = voices.filter(voice => voice.lang.includes('en'));
      
      englishVoices.forEach((voice, index) => {
        const voiceBtn = document.createElement('div');
        voiceBtn.className = 'voice-option';
        if (index === 0) {
          voiceBtn.classList.add('selected');
          selectedVoice = voice;
        }
        voiceBtn.textContent = `${voice.name} (${voice.lang})`;
        voiceBtn.addEventListener('click', () => {
          document.querySelectorAll('.voice-option').forEach(opt => {
            opt.classList.remove('selected');
          });
          voiceBtn.classList.add('selected');
          selectedVoice = voice;
          saveSettings();
        });
        voiceOptions.appendChild(voiceBtn);
      });
    }

    function speak(text) {
      if (!speechSynthesis || !selectedVoice || !isVoiceEnabled) return;
      
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.voice = selectedVoice;
      utterance.rate = 1;
      utterance.pitch = 1;
      
      speechSynthesis.speak(utterance);
    }

    // Voice Recognition Functions
    function initVoiceRecognition() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      
      if (!SpeechRecognition) {
        micBtn.disabled = true;
        micBtn.title = 'Speech recognition not supported in your browser';
        return;
      }
      
      const recognition = new SpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.lang = 'en-US';
      
      micBtn.addEventListener('click', () => {
        if (micBtn.classList.contains('listening')) {
          recognition.stop();
          micBtn.classList.remove('listening');
        } else {
          recognition.start();
          micBtn.classList.add('listening');
        }
      });
      
      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        userInput.value = transcript;
        micBtn.classList.remove('listening');
        sendMessage();
      };
      
      recognition.onerror = (event) => {
        console.error('Speech recognition error', event.error);
        micBtn.classList.remove('listening');
      };
      
      recognition.onend = () => {
        micBtn.classList.remove('listening');
      };
    }

    // Wake Word Detection
    function initWakeWordDetection() {
      // In a real implementation, you would use a proper wake word detection library
      // This is a simplified version that listens for "hey nova" in the microphone
      
      if (wakeWordDetection) {
        wakeWordDetection.stop();
      }
      
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      
      if (!SpeechRecognition) {
        wakeWordToggle.checked = false;
        saveSettings();
        alert('Wake word detection requires speech recognition support');
        return;
      }
      
      wakeWordDetection = new SpeechRecognition();
      wakeWordDetection.continuous = true;
      wakeWordDetection.interimResults = true;
      wakeWordDetection.lang = 'en-US';
      
      wakeWordDetection.onresult = (event) => {
        for (let i = event.resultIndex; i < event.results.length; i++) {
          const transcript = event.results[i][0].transcript.toLowerCase();
          if (event.results[i].isFinal && transcript.includes('hey nova')) {
            // Stop listening and focus on input
            wakeWordDetection.stop();
            userInput.focus();
            
            // Show visual feedback
            const originalPlaceholder = userInput.placeholder;
            userInput.placeholder = "Listening... How can I help?";
            
            setTimeout(() => {
              userInput.placeholder = originalPlaceholder;
            }, 3000);
            
            break;
          }
        }
      };
      
      wakeWordDetection.onerror = (event) => {
        console.error('Wake word detection error', event.error);
      };
      
      wakeWordDetection.start();
    }

    function stopWakeWordDetection() {
      if (wakeWordDetection) {
        wakeWordDetection.stop();
        wakeWordDetection = null;
      }
    }

    // Settings Functions
    function openSettings() {
      settingsPanel.classList.add('open');
      overlay.classList.add('visible');
    }

    function closeSettingsPanel() {
      settingsPanel.classList.remove('open');
      overlay.classList.remove('visible');
      saveSettings();
    }

    function toggleSpeech() {
      saveSettings();
    }

    function toggleWakeWordDetection() {
      if (wakeWordToggle.checked) {
        initWakeWordDetection();
      } else {
        stopWakeWordDetection();
      }
      saveSettings();
    }

    function toggleDarkMode() {
      document.body.classList.toggle('light-mode');
      saveSettings();
    }

    function loadSettings() {
      const settings = JSON.parse(localStorage.getItem('novaSettings')) || {};
      
      if (settings.speechEnabled !== undefined) {
        speechToggle.checked = settings.speechEnabled;
      }
      
      if (settings.wakeWordEnabled !== undefined) {
        wakeWordToggle.checked = settings.wakeWordEnabled;
      }
      
      if (settings.darkMode !== undefined) {
        darkModeToggle.checked = settings.darkMode;
        if (settings.darkMode) {
          document.body.classList.add('dark-mode');
        } else {
          document.body.classList.add('light-mode');
        }
      }
      
      if (settings.voiceEnabled !== undefined) {
        isVoiceEnabled = settings.voiceEnabled;
        updateVoiceToggleUI();
      }
      
      if (settings.reasoningEnabled !== undefined) {
        reasoningToggle.checked = settings.reasoningEnabled;
      }
      
      if (settings.memoryEnabled !== undefined) {
        memoryToggle.checked = settings.memoryEnabled;
      }
      
      if (settings.creativityEnabled !== undefined) {
        creativityToggle.checked = settings.creativityEnabled;
      }
    }

    function saveSettings() {
      const settings = {
        speechEnabled: speechToggle.checked,
        wakeWordEnabled: wakeWordToggle.checked,
        darkMode: darkModeToggle.checked,
        voiceEnabled: isVoiceEnabled,
        reasoningEnabled: reasoningToggle.checked,
        memoryEnabled: memoryToggle.checked,
        creativityEnabled: creativityToggle.checked
      };
      
      localStorage.setItem('novaSettings', JSON.stringify(settings));
    }

    // Initialize voice recognition
    initVoiceRecognition();
  </script>
</body>
</html>

  
